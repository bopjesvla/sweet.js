"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.serializer = exports.makeDeserializer = undefined;

var _transitJs = require("transit-js");

var _transitJs2 = _interopRequireDefault(_transitJs);

var _immutable = require("immutable");

var _syntax = require("./syntax");

var _syntax2 = _interopRequireDefault(_syntax);

var _symbol = require("./symbol");

var _tokenizer = require("shift-parser/dist/tokenizer");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var typeMap_469 = [_tokenizer.TokenType.STRING, _tokenizer.TokenType.EOS, _tokenizer.TokenType.LPAREN, _tokenizer.TokenType.RPAREN, _tokenizer.TokenType.LBRACK, _tokenizer.TokenType.RBRACK, _tokenizer.TokenType.LBRACE, _tokenizer.TokenType.RBRACE, _tokenizer.TokenType.COLON, _tokenizer.TokenType.SEMICOLON, _tokenizer.TokenType.PERIOD, _tokenizer.TokenType.ELLIPSIS, _tokenizer.TokenType.ARROW, _tokenizer.TokenType.CONDITIONAL, _tokenizer.TokenType.INC, _tokenizer.TokenType.DEC, _tokenizer.TokenType.ASSIGN, _tokenizer.TokenType.ASSIGN_BIT_OR, _tokenizer.TokenType.ASSIGN_BIT_XOR, _tokenizer.TokenType.ASSIGN_BIT_AND, _tokenizer.TokenType.ASSIGN_SHL, _tokenizer.TokenType.ASSIGN_SHR, _tokenizer.TokenType.ASSIGN_SHR_UNSIGNED, _tokenizer.TokenType.ASSIGN_ADD, _tokenizer.TokenType.ASSIGN_SUB, _tokenizer.TokenType.ASSIGN_MUL, _tokenizer.TokenType.ASSIGN_DIV, _tokenizer.TokenType.ASSIGN_MOD, _tokenizer.TokenType.COMMA, _tokenizer.TokenType.OR, _tokenizer.TokenType.AND, _tokenizer.TokenType.BIT_OR, _tokenizer.TokenType.BIT_XOR, _tokenizer.TokenType.BIT_AND, _tokenizer.TokenType.SHL, _tokenizer.TokenType.SHR, _tokenizer.TokenType.SHR_UNSIGNED, _tokenizer.TokenType.ADD, _tokenizer.TokenType.SUB, _tokenizer.TokenType.MUL, _tokenizer.TokenType.DIV, _tokenizer.TokenType.MOD, _tokenizer.TokenType.EQ, _tokenizer.TokenType.NE, _tokenizer.TokenType.EQ_STRICT, _tokenizer.TokenType.NE_STRICT, _tokenizer.TokenType.LT, _tokenizer.TokenType.GT, _tokenizer.TokenType.LTE, _tokenizer.TokenType.GTE, _tokenizer.TokenType.INSTANCEOF, _tokenizer.TokenType.IN, _tokenizer.TokenType.NOT, _tokenizer.TokenType.BIT_NOT, _tokenizer.TokenType.AWAIT, _tokenizer.TokenType.DELETE, _tokenizer.TokenType.TYPEOF, _tokenizer.TokenType.VOID, _tokenizer.TokenType.BREAK, _tokenizer.TokenType.CASE, _tokenizer.TokenType.CATCH, _tokenizer.TokenType.CLASS, _tokenizer.TokenType.CONTINUE, _tokenizer.TokenType.DEBUGGER, _tokenizer.TokenType.DEFAULT, _tokenizer.TokenType.DO, _tokenizer.TokenType.ELSE, _tokenizer.TokenType.EXPORT, _tokenizer.TokenType.EXTENDS, _tokenizer.TokenType.FINALLY, _tokenizer.TokenType.FOR, _tokenizer.TokenType.FUNCTION, _tokenizer.TokenType.IF, _tokenizer.TokenType.IMPORT, _tokenizer.TokenType.LET, _tokenizer.TokenType.NEW, _tokenizer.TokenType.RETURN, _tokenizer.TokenType.SUPER, _tokenizer.TokenType.SWITCH, _tokenizer.TokenType.THIS, _tokenizer.TokenType.THROW, _tokenizer.TokenType.TRY, _tokenizer.TokenType.VAR, _tokenizer.TokenType.WHILE, _tokenizer.TokenType.WITH, _tokenizer.TokenType.NULL, _tokenizer.TokenType.TRUE, _tokenizer.TokenType.FALSE, _tokenizer.TokenType.YIELD, _tokenizer.TokenType.NUMBER, _tokenizer.TokenType.STRING, _tokenizer.TokenType.REGEXP, _tokenizer.TokenType.IDENTIFIER, _tokenizer.TokenType.CONST, _tokenizer.TokenType.TEMPLATE, _tokenizer.TokenType.ILLEGAL];
var ListHandler_470 = _transitJs2.default.makeWriteHandler({ tag: function tag() {
    return "array";
  }, rep: function rep(v_475) {
    return v_475;
  } });
var SyntaxHandler_471 = _transitJs2.default.makeWriteHandler({ tag: function tag() {
    return "stx";
  }, rep: function rep(v_476) {
    if (_immutable.List.isList(v_476.token)) {
      return [v_476.token, v_476.context.scopeset];
    } else {
      var t = _transitJs2.default.objectToMap(v_476.token);
      t.set("type", typeMap_469.indexOf(v_476.token.type));
      return [t, v_476.context.scopeset];
    }
  } });
var SymbolHandler_472 = _transitJs2.default.makeWriteHandler({ tag: function tag() {
    return "symb";
  }, rep: function rep(v_477) {
    return [v_477.name];
  } });
var writer_473 = _transitJs2.default.writer("json", { handlers: _transitJs2.default.map([_immutable.List, ListHandler_470, _syntax2.default, SyntaxHandler_471, _symbol.SymbolClass, SymbolHandler_472]) });
function makeReader_474(bindings_478) {
  return _transitJs2.default.reader("json", { arrayBuilder: { init: function init(node_479) {
        return (0, _immutable.List)().asMutable();
      }, add: function add(ret_480, val_481, node_482) {
        return ret_480.push(val_481);
      }, finalize: function finalize(ret_483, node_484) {
        return ret_483.asImmutable();
      }, fromArray: function fromArray(arr_485, node_486) {
        return (0, _immutable.List)(arr_485);
      } }, handlers: { stx: function stx(rep_487) {
        if (_immutable.List.isList(rep_487[0])) {
          var token = rep_487[0];
          return new _syntax2.default(token, { bindings: bindings_478, scopeset: rep_487[1] });
        } else {
          var token = _transitJs2.default.mapToObject(rep_487[0]);
          token.type = typeMap_469[rep_487[0].get("type")];
          token.slice = rep_487[0].has("slice") ? _transitJs2.default.mapToObject(rep_487[0].get("slice")) : undefined;
          if (token.slice) {
            token.slice.startLocation = _transitJs2.default.mapToObject(token.slice.startLocation);
          }
          return new _syntax2.default(token, { bindings: bindings_478, scopeset: rep_487[1] });
        }
      }, symb: function symb(rep_488) {
        return (0, _symbol.Symbol)(rep_488[0]);
      } } });
}
exports.makeDeserializer = makeReader_474;
exports.serializer = writer_473;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3N3ZWV0L3NlcmlhbGl6ZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFLQSxJQUFJLFdBQVcsR0FBRyxDQUFDLHFCQUFVLE1BQU0sRUFBRSxxQkFBVSxHQUFHLEVBQUUscUJBQVUsTUFBTSxFQUFFLHFCQUFVLE1BQU0sRUFBRSxxQkFBVSxNQUFNLEVBQUUscUJBQVUsTUFBTSxFQUFFLHFCQUFVLE1BQU0sRUFBRSxxQkFBVSxNQUFNLEVBQUUscUJBQVUsS0FBSyxFQUFFLHFCQUFVLFNBQVMsRUFBRSxxQkFBVSxNQUFNLEVBQUUscUJBQVUsUUFBUSxFQUFFLHFCQUFVLEtBQUssRUFBRSxxQkFBVSxXQUFXLEVBQUUscUJBQVUsR0FBRyxFQUFFLHFCQUFVLEdBQUcsRUFBRSxxQkFBVSxNQUFNLEVBQUUscUJBQVUsYUFBYSxFQUFFLHFCQUFVLGNBQWMsRUFBRSxxQkFBVSxjQUFjLEVBQUUscUJBQVUsVUFBVSxFQUFFLHFCQUFVLFVBQVUsRUFBRSxxQkFBVSxtQkFBbUIsRUFBRSxxQkFBVSxVQUFVLEVBQUUscUJBQVUsVUFBVSxFQUFFLHFCQUFVLFVBQVUsRUFBRSxxQkFBVSxVQUFVLEVBQUUscUJBQVUsVUFBVSxFQUFFLHFCQUFVLEtBQUssRUFBRSxxQkFBVSxFQUFFLEVBQUUscUJBQVUsR0FBRyxFQUFFLHFCQUFVLE1BQU0sRUFBRSxxQkFBVSxPQUFPLEVBQUUscUJBQVUsT0FBTyxFQUFFLHFCQUFVLEdBQUcsRUFBRSxxQkFBVSxHQUFHLEVBQUUscUJBQVUsWUFBWSxFQUFFLHFCQUFVLEdBQUcsRUFBRSxxQkFBVSxHQUFHLEVBQUUscUJBQVUsR0FBRyxFQUFFLHFCQUFVLEdBQUcsRUFBRSxxQkFBVSxHQUFHLEVBQUUscUJBQVUsRUFBRSxFQUFFLHFCQUFVLEVBQUUsRUFBRSxxQkFBVSxTQUFTLEVBQUUscUJBQVUsU0FBUyxFQUFFLHFCQUFVLEVBQUUsRUFBRSxxQkFBVSxFQUFFLEVBQUUscUJBQVUsR0FBRyxFQUFFLHFCQUFVLEdBQUcsRUFBRSxxQkFBVSxVQUFVLEVBQUUscUJBQVUsRUFBRSxFQUFFLHFCQUFVLEdBQUcsRUFBRSxxQkFBVSxPQUFPLEVBQUUscUJBQVUsS0FBSyxFQUFFLHFCQUFVLE1BQU0sRUFBRSxxQkFBVSxNQUFNLEVBQUUscUJBQVUsSUFBSSxFQUFFLHFCQUFVLEtBQUssRUFBRSxxQkFBVSxJQUFJLEVBQUUscUJBQVUsS0FBSyxFQUFFLHFCQUFVLEtBQUssRUFBRSxxQkFBVSxRQUFRLEVBQUUscUJBQVUsUUFBUSxFQUFFLHFCQUFVLE9BQU8sRUFBRSxxQkFBVSxFQUFFLEVBQUUscUJBQVUsSUFBSSxFQUFFLHFCQUFVLE1BQU0sRUFBRSxxQkFBVSxPQUFPLEVBQUUscUJBQVUsT0FBTyxFQUFFLHFCQUFVLEdBQUcsRUFBRSxxQkFBVSxRQUFRLEVBQUUscUJBQVUsRUFBRSxFQUFFLHFCQUFVLE1BQU0sRUFBRSxxQkFBVSxHQUFHLEVBQUUscUJBQVUsR0FBRyxFQUFFLHFCQUFVLE1BQU0sRUFBRSxxQkFBVSxLQUFLLEVBQUUscUJBQVUsTUFBTSxFQUFFLHFCQUFVLElBQUksRUFBRSxxQkFBVSxLQUFLLEVBQUUscUJBQVUsR0FBRyxFQUFFLHFCQUFVLEdBQUcsRUFBRSxxQkFBVSxLQUFLLEVBQUUscUJBQVUsSUFBSSxFQUFFLHFCQUFVLElBQUksRUFBRSxxQkFBVSxJQUFJLEVBQUUscUJBQVUsS0FBSyxFQUFFLHFCQUFVLEtBQUssRUFBRSxxQkFBVSxNQUFNLEVBQUUscUJBQVUsTUFBTSxFQUFFLHFCQUFVLE1BQU0sRUFBRSxxQkFBVSxVQUFVLEVBQUUscUJBQVUsS0FBSyxFQUFFLHFCQUFVLFFBQVEsRUFBRSxxQkFBVSxPQUFPLENBQUMsQ0FBQztBQUM1c0QsSUFBSSxlQUFlLEdBQUcsb0JBQVEsZ0JBQWdCLENBQUMsRUFBQyxHQUFHLEVBQUU7V0FBTSxPQUFPO0dBQUEsRUFBRSxHQUFHLEVBQUUsYUFBQSxLQUFLO1dBQUksS0FBSztHQUFBLEVBQUMsQ0FBQyxDQUFDO0FBQzFGLElBQUks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QUM1RTtBQUNELGlCQUFPLHFCQUFXLEtBQUssRUFBRSxFQUFDLFFBQVEsRUFBRSxZQUFZLEVBQUUsUUFBUSxFQUFFLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBQyxDQUFDLENBQUM7U0FDMUU7T0FDRixFQUFFLElBQUksRUFBRSxjQUFBLE9BQU8sRUFBSTtBQUNsQixlQUFPLG9CQUFPLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO09BQzNCLEVBQUMsRUFBQyxDQUFDLENBQUM7Q0FDTjtRQUN5QixnQkFBZ0IsR0FBbEMsY0FBYztRQUFvQyxVQUFVLEdBQXhCLFVBQVUiLCJmaWxlIjoic2VyaWFsaXplci5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB0cmFuc2l0IGZyb20gXCJ0cmFuc2l0LWpzXCI7XG5pbXBvcnQge0xpc3R9IGZyb20gXCJpbW11dGFibGVcIjtcbmltcG9ydCBTeW50YXggZnJvbSBcIi4vc3ludGF4XCI7XG5pbXBvcnQge1N5bWJvbCwgZ2Vuc3ltLCBTeW1ib2xDbGFzc30gZnJvbSBcIi4vc3ltYm9sXCI7XG5pbXBvcnQge1Rva2VuQ2xhc3MsIFRva2VuVHlwZX0gZnJvbSBcInNoaWZ0LXBhcnNlci9kaXN0L3Rva2VuaXplclwiO1xubGV0IHR5cGVNYXBfNDY5ID0gW1Rva2VuVHlwZS5TVFJJTkcsIFRva2VuVHlwZS5FT1MsIFRva2VuVHlwZS5MUEFSRU4sIFRva2VuVHlwZS5SUEFSRU4sIFRva2VuVHlwZS5MQlJBQ0ssIFRva2VuVHlwZS5SQlJBQ0ssIFRva2VuVHlwZS5MQlJBQ0UsIFRva2VuVHlwZS5SQlJBQ0UsIFRva2VuVHlwZS5DT0xPTiwgVG9rZW5UeXBlLlNFTUlDT0xPTiwgVG9rZW5UeXBlLlBFUklPRCwgVG9rZW5UeXBlLkVMTElQU0lTLCBUb2tlblR5cGUuQVJST1csIFRva2VuVHlwZS5DT05ESVRJT05BTCwgVG9rZW5UeXBlLklOQywgVG9rZW5UeXBlLkRFQywgVG9rZW5UeXBlLkFTU0lHTiwgVG9rZW5UeXBlLkFTU0lHTl9CSVRfT1IsIFRva2VuVHlwZS5BU1NJR05fQklUX1hPUiwgVG9rZW5UeXBlLkFTU0lHTl9CSVRfQU5ELCBUb2tlblR5cGUuQVNTSUdOX1NITCwgVG9rZW5UeXBlLkFTU0lHTl9TSFIsIFRva2VuVHlwZS5BU1NJR05fU0hSX1VOU0lHTkVELCBUb2tlblR5cGUuQVNTSUdOX0FERCwgVG9rZW5UeXBlLkFTU0lHTl9TVUIsIFRva2VuVHlwZS5BU1NJR05fTVVMLCBUb2tlblR5cGUuQVNTSUdOX0RJViwgVG9rZW5UeXBlLkFTU0lHTl9NT0QsIFRva2VuVHlwZS5DT01NQSwgVG9rZW5UeXBlLk9SLCBUb2tlblR5cGUuQU5ELCBUb2tlblR5cGUuQklUX09SLCBUb2tlblR5cGUuQklUX1hPUiwgVG9rZW5UeXBlLkJJVF9BTkQsIFRva2VuVHlwZS5TSEwsIFRva2VuVHlwZS5TSFIsIFRva2VuVHlwZS5TSFJfVU5TSUdORUQsIFRva2VuVHlwZS5BREQsIFRva2VuVHlwZS5TVUIsIFRva2VuVHlwZS5NVUwsIFRva2VuVHlwZS5ESVYsIFRva2VuVHlwZS5NT0QsIFRva2VuVHlwZS5FUSwgVG9rZW5UeXBlLk5FLCBUb2tlblR5cGUuRVFfU1RSSUNULCBUb2tlblR5cGUuTkVfU1RSSUNULCBUb2tlblR5cGUuTFQsIFRva2VuVHlwZS5HVCwgVG9rZW5UeXBlLkxURSwgVG9rZW5UeXBlLkdURSwgVG9rZW5UeXBlLklOU1RBTkNFT0YsIFRva2VuVHlwZS5JTiwgVG9rZW5UeXBlLk5PVCwgVG9rZW5UeXBlLkJJVF9OT1QsIFRva2VuVHlwZS5BV0FJVCwgVG9rZW5UeXBlLkRFTEVURSwgVG9rZW5UeXBlLlRZUEVPRiwgVG9rZW5UeXBlLlZPSUQsIFRva2VuVHlwZS5CUkVBSywgVG9rZW5UeXBlLkNBU0UsIFRva2VuVHlwZS5DQVRDSCwgVG9rZW5UeXBlLkNMQVNTLCBUb2tlblR5cGUuQ09OVElOVUUsIFRva2VuVHlwZS5ERUJVR0dFUiwgVG9rZW5UeXBlLkRFRkFVTFQsIFRva2VuVHlwZS5ETywgVG9rZW5UeXBlLkVMU0UsIFRva2VuVHlwZS5FWFBPUlQsIFRva2VuVHlwZS5FWFRFTkRTLCBUb2tlblR5cGUuRklOQUxMWSwgVG9rZW5UeXBlLkZPUiwgVG9rZW5UeXBlLkZVTkNUSU9OLCBUb2tlblR5cGUuSUYsIFRva2VuVHlwZS5JTVBPUlQsIFRva2VuVHlwZS5MRVQsIFRva2VuVHlwZS5ORVcsIFRva2VuVHlwZS5SRVRVUk4sIFRva2VuVHlwZS5TVVBFUiwgVG9rZW5UeXBlLlNXSVRDSCwgVG9rZW5UeXBlLlRISVMsIFRva2VuVHlwZS5USFJPVywgVG9rZW5UeXBlLlRSWSwgVG9rZW5UeXBlLlZBUiwgVG9rZW5UeXBlLldISUxFLCBUb2tlblR5cGUuV0lUSCwgVG9rZW5UeXBlLk5VTEwsIFRva2VuVHlwZS5UUlVFLCBUb2tlblR5cGUuRkFMU0UsIFRva2VuVHlwZS5ZSUVMRCwgVG9rZW5UeXBlLk5VTUJFUiwgVG9rZW5UeXBlLlNUUklORywgVG9rZW5UeXBlLlJFR0VYUCwgVG9rZW5UeXBlLklERU5USUZJRVIsIFRva2VuVHlwZS5DT05TVCwgVG9rZW5UeXBlLlRFTVBMQVRFLCBUb2tlblR5cGUuSUxMRUdBTF07XG5sZXQgTGlzdEhhbmRsZXJfNDcwID0gdHJhbnNpdC5tYWtlV3JpdGVIYW5kbGVyKHt0YWc6ICgpID0+IFwiYXJyYXlcIiwgcmVwOiB2XzQ3NSA9PiB2XzQ3NX0pO1xubGV0IFN5bnRheEhhbmRsZXJfNDcxID0gdHJhbnNpdC5tYWtlV3JpdGVIYW5kbGVyKHt0YWc6ICgpID0+IFwic3R4XCIsIHJlcDogdl80NzYgPT4ge1xuICBpZiAoTGlzdC5pc0xpc3Qodl80NzYudG9rZW4pKSB7XG4gICAgcmV0dXJuIFt2XzQ3Ni50b2tlbiwgdl80NzYuY29udGV4dC5zY29wZXNldF07XG4gIH0gZWxzZSB7XG4gICAgbGV0IHQgPSB0cmFuc2l0Lm9iamVjdFRvTWFwKHZfNDc2LnRva2VuKTtcbiAgICB0LnNldChcInR5cGVcIiwgdHlwZU1hcF80NjkuaW5kZXhPZih2XzQ3Ni50b2tlbi50eXBlKSk7XG4gICAgcmV0dXJuIFt0LCB2XzQ3Ni5jb250ZXh0LnNjb3Blc2V0XTtcbiAgfVxufX0pO1xubGV0IFN5bWJvbEhhbmRsZXJfNDcyID0gdHJhbnNpdC5tYWtlV3JpdGVIYW5kbGVyKHt0YWc6ICgpID0+IFwic3ltYlwiLCByZXA6IHZfNDc3ID0+IFt2XzQ3Ny5uYW1lXX0pO1xubGV0IHdyaXRlcl80NzMgPSB0cmFuc2l0LndyaXRlcihcImpzb25cIiwge2hhbmRsZXJzOiB0cmFuc2l0Lm1hcChbTGlzdCwgTGlzdEhhbmRsZXJfNDcwLCBTeW50YXgsIFN5bnRheEhhbmRsZXJfNDcxLCBTeW1ib2xDbGFzcywgU3ltYm9sSGFuZGxlcl80NzJdKX0pO1xuZnVuY3Rpb24gbWFrZVJlYWRlcl80NzQoYmluZGluZ3NfNDc4KSB7XG4gIHJldHVybiB0cmFuc2l0LnJlYWRlcihcImpzb25cIiwge2FycmF5QnVpbGRlcjoge2luaXQ6IG5vZGVfNDc5ID0+IExpc3QoKS5hc011dGFibGUoKSwgYWRkOiAocmV0XzQ4MCwgdmFsXzQ4MSwgbm9kZV80ODIpID0+IHJldF80ODAucHVzaCh2YWxfNDgxKSwgZmluYWxpemU6IChyZXRfNDgzLCBub2RlXzQ4NCkgPT4gcmV0XzQ4My5hc0ltbXV0YWJsZSgpLCBmcm9tQXJyYXk6IChhcnJfNDg1LCBub2RlXzQ4NikgPT4gTGlzdChhcnJfNDg1KX0sIGhhbmRsZXJzOiB7c3R4OiByZXBfNDg3ID0+IHtcbiAgICBpZiAoTGlzdC5pc0xpc3QocmVwXzQ4N1swXSkpIHtcbiAgICAgIGxldCB0b2tlbiA9IHJlcF80ODdbMF07XG4gICAgICByZXR1cm4gbmV3IFN5bnRheCh0b2tlbiwge2JpbmRpbmdzOiBiaW5kaW5nc180NzgsIHNjb3Blc2V0OiByZXBfNDg3WzFdfSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGxldCB0b2tlbiA9IHRyYW5zaXQubWFwVG9PYmplY3QocmVwXzQ4N1swXSk7XG4gICAgICB0b2tlbi50eXBlID0gdHlwZU1hcF80NjlbcmVwXzQ4N1swXS5nZXQoXCJ0eXBlXCIpXTtcbiAgICAgIHRva2VuLnNsaWNlID0gcmVwXzQ4N1swXS5oYXMoXCJzbGljZVwiKSA/IHRyYW5zaXQubWFwVG9PYmplY3QocmVwXzQ4N1swXS5nZXQoXCJzbGljZVwiKSkgOiB1bmRlZmluZWQ7XG4gICAgICBpZiAodG9rZW4uc2xpY2UpIHtcbiAgICAgICAgdG9rZW4uc2xpY2Uuc3RhcnRMb2NhdGlvbiA9IHRyYW5zaXQubWFwVG9PYmplY3QodG9rZW4uc2xpY2Uuc3RhcnRMb2NhdGlvbik7XG4gICAgICB9XG4gICAgICByZXR1cm4gbmV3IFN5bnRheCh0b2tlbiwge2JpbmRpbmdzOiBiaW5kaW5nc180NzgsIHNjb3Blc2V0OiByZXBfNDg3WzFdfSk7XG4gICAgfVxuICB9LCBzeW1iOiByZXBfNDg4ID0+IHtcbiAgICByZXR1cm4gU3ltYm9sKHJlcF80ODhbMF0pO1xuICB9fX0pO1xufVxuZXhwb3J0IHttYWtlUmVhZGVyXzQ3NCBhcyBtYWtlRGVzZXJpYWxpemVyLCB3cml0ZXJfNDczIGFzIHNlcmlhbGl6ZXJ9O1xuIl19